<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Details</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<button onclick="goHome()">⬅ Back</button>

<h1 id="title"></h1>

<div class="movie-details">
    <p><b>Genre:</b> <span id="genre"></span></p>
    <p><b>Year:</b> <span id="year"></span></p>
    <p><b>Country:</b> <span id="country"></span></p>
    <p><b>Rating:</b> <span id="rating"></span></p>
    <p><b>Description:</b></p>
    <p id="description"></p>

    <button onclick="addToFavorites()">❤️ Add to Favorites</button>

    <h3>Play Movie</h3>
    <select id="quality">
        <option value="low">Low Quality</option>
        <option value="medium" selected>Medium Quality</option>
        <option value="high">High Quality</option>
    </select>

    <button onclick="playMovie()">▶ Play</button>

    <p id="playResult" style="margin-top:20px; color:blue; font-weight:bold;"></p>
</div>

<script>
const API_URL = "http://127.0.0.1:8000";

// Read movie ID from URL (movie.html?id=5)
const urlParams = new URLSearchParams(window.location.search);
const movieId = urlParams.get("id");

// Load movie on page start
loadMovie();

async function loadMovie() {
    const res = await fetch(`${API_URL}/movies/${movieId}`);
    const movie = await res.json();

    document.getElementById("title").innerText = movie.title;
    document.getElementById("genre").innerText = movie.genre;
    document.getElementById("year").innerText = movie.year;
    document.getElementById("country").innerText = movie.country;
    document.getElementById("rating").innerText = movie.rating;
    document.getElementById("description").innerText = movie.description;
}

// Add to favorites
async function addToFavorites() {
    const userId = localStorage.getItem("user_id");

    if (!userId) {
        alert("You must log in first!");
        return;
    }

    const res = await fetch(`${API_URL}/favorites/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            user_id: userId,
            movie_id: Number(movieId)
        })
    });

    if (res.ok) {
        alert("Added to favorites!");
    } else {
        alert("Already in favorites!");
    }
}

// Play movie with selected quality
async function playMovie() {
    const quality = document.getElementById("quality").value;

    const res = await fetch(`${API_URL}/movies/${movieId}/play?quality=${quality}`);
    const data = await res.json();

    document.getElementById("playResult").innerText = data.result;
}

// Navigation
function goHome() {
    window.location.href = "index.html";
}
</script>

</body>
</html>
