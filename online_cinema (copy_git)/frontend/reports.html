<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Reports â€” Online Cinema</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .report { margin: 20px 0; background: #fff; padding: 12px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>
  <h1>Reports</h1>

  <div class="report">
    <h2>Popular Movies</h2>
    <div id="popular-movies">Loading...</div>
  </div>

  <div class="report">
    <h2>Popular Genres</h2>
    <div id="popular-genres">Loading...</div>
  </div>

  <div class="report">
    <h2>User Activity</h2>
    <div id="user-activity">Loading...</div>
  </div>

  <div class="report">
    <h2>Subscription Income</h2>
    <div id="subscription-income">Loading...</div>
  </div>

<script>
const API = "http://127.0.0.1:8000";

async function loadPopularMovies() {
  const res = await fetch(`${API}/reports/popular-movies`);
  const data = await res.json();
  const container = document.getElementById("popular-movies");
  if (!data || data.length === 0) { container.innerText = "No data"; return; }
  let html = '<table><tr><th>Title</th><th>Genre</th><th>Favorites</th></tr>';
  data.forEach(r => {
    html += `<tr><td>${r.title}</td><td>${r.genre}</td><td>${r.favorites_count}</td></tr>`;
  });
  html += '</table>';
  container.innerHTML = html;
}

async function loadPopularGenres() {
  const res = await fetch(`${API}/reports/popular-genres`);
  const data = await res.json();
  const container = document.getElementById("popular-genres");
  if (!data || data.length === 0) { container.innerText = "No data"; return; }
  let html = '<table><tr><th>Genre</th><th>Count</th></tr>';
  data.forEach(r => { html += `<tr><td>${r.genre}</td><td>${r.count}</td></tr>`; });
  html += '</table>';
  container.innerHTML = html;
}

async function loadUserActivity() {
  const res = await fetch(`${API}/reports/user-activity`);
  const data = await res.json();
  const container = document.getElementById("user-activity");
  if (!data || data.length === 0) { container.innerText = "No data"; return; }
  let html = '<table><tr><th>User</th><th>Favorites</th></tr>';
  data.forEach(r => { html += `<tr><td>${r.username}</td><td>${r.favorites_count}</td></tr>`; });
  html += '</table>';
  container.innerHTML = html;
}

async function loadSubscriptionIncome() {
  const res = await fetch(`${API}/reports/subscription-income`);
  const data = await res.json();
  const container = document.getElementById("subscription-income");
  if (!data || !data.details) { container.innerText = "No data"; return; }
  let html = '<table><tr><th>Type</th><th>Users</th><th>Price</th><th>Total</th></tr>';
  data.details.forEach(r => {
    html += `<tr><td>${r.subscription_type}</td><td>${r.users}</td><td>${r.price_per_user}</td><td>${r.total_income}</td></tr>`;
  });
  html += `<tr><td colspan="3"><b>Total</b></td><td><b>${data.total_income}</b></td></tr></table>`;
  container.innerHTML = html;
}

loadPopularMovies();
loadPopularGenres();
loadUserActivity();
loadSubscriptionIncome();
</script>
</body>
</html>
