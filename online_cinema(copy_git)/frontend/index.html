<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Cinema</title>
    <link rel="stylesheet" href="style.css">
</head>

<!-- AD BANNER -->
<div id="ad-banner" style="
    background: #ffcc00;
    padding: 20px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    margin-top: 20px;
    border-radius: 8px;
">
    üî•–ö—É–ø—ñ—Ç—å —Å—É–ø–µ—Ä –≥—Ä—É! WOT —ñ –≥—Ä–∞–π—Ç–µ—Å—è –≤ —Ç–∞–Ω—á–∏–∫–∏! (Buy Premium & Remove Ads! Only $1.99/month!)
</div>


<body>

<header>
    <h1>Online Cinema</h1>

    <nav>
        <button onclick="goProfile()" id="profileBtn" style="display:none;">Profile</button>
        <button onclick="goLogin()" id="loginBtn">Login</button>
    </nav>
</header>

<input type="text" id="searchInput" placeholder="Search movies...">
<button onclick="searchMovies()">Search</button>

<h2>All Movies</h2>
<div id="moviesList"></div>

<script>
const API_URL = "http://127.0.0.1:8000";


async function checkAdBanner() {
    const userId = localStorage.getItem("user_id");

    if (!userId) return; // –≥—ñ—Å—Ç—å ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∫–ª–∞–º—É

    const res = await fetch(`${API_URL}/users/${userId}`);
    if (!res.ok) return;

    const user = await res.json();

    if (user.subscription_type === "premium") {
        document.getElementById("ad-banner").style.display = "none";
    }
}

async function loadMovies() {
    const res = await fetch(`${API_URL}/movies/`);
    const movies = await res.json();
    renderMovies(movies);
}

async function searchMovies() {
    const query = document.getElementById("searchInput").value;
    const res = await fetch(`${API_URL}/movies/search?title=${query}`);
    const movies = await res.json();
    renderMovies(movies);
}

function renderMovies(movies) {
    const container = document.getElementById("moviesList");
    container.innerHTML = "";

    movies.forEach(m => {
        const card = document.createElement("div");
        card.className = "movie-card";

        card.innerHTML = `
            <h3>${m.title}</h3>
            <p><b>Genre:</b> ${m.genre}</p>
            <p><b>Year:</b> ${m.year}</p>
            <button onclick="openMovie(${m.id})">Details</button>
        `;

        container.appendChild(card);
    });
}

function openMovie(id) {
    window.location.href = `movie.html?id=${id}`;
}

// ==== LOGIN / PROFILE BUTTON CONTROL ====
const user = localStorage.getItem("user_id");
if (user) {
    document.getElementById("profileBtn").style.display = "inline-block";
    document.getElementById("loginBtn").style.display = "none";
}

function goLogin() {
    window.location.href = "login.html";
}

function goProfile() {
    window.location.href = "profile.html";
}

loadMovies();
checkAdBanner();
</script>

</body>
</html>
